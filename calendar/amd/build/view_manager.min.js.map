{"version":3,"sources":["../src/view_manager.js"],"names":["registerEventListeners","root","container","parent","limitdayevents","data","console","info","on","CalendarSelectors","links","eventLink","e","target","eventId","pendingPromise","Pending","matches","actions","viewEvent","closest","dataset","querySelector","preventDefault","stopPropagation","renderEventSummaryModal","then","resolve","catch","navLink","wrapper","find","view","courseId","categoryId","link","currentTarget","changeMonth","href","year","month","day","changeDay","viewSelector","CustomEvents","define","events","activate","option","classList","contains","courseid","categoryid","refreshMonthContent","updateUrl","fail","Notification","exception","refreshDayContent","reloadCurrentUpcoming","template","startLoading","attr","M","util","js_pending","get","join","includenavigation","mini","viewMode","CalendarRepository","getCalendarMonthData","context","Templates","render","html","js","replaceNode","document","dispatchEvent","CustomEvent","CalendarEvents","viewUpdated","always","js_complete","stopLoading","url","length","args","trigger","monthChanged","reloadCurrentMonth","getCalendarDayData","viewingday","showviewselector","reloadCurrentDay","dayChanged","viewingFullCalendar","getElementById","fullCalendarView","window","history","pushState","loadingIconContainer","containers","loadingIcon","removeClass","addClass","getCalendarUpcomingData","viewingupcoming","getEventTypeClassFromType","eventType","getEventById","getEventResponse","event","Error","eventData","modalParams","title","name","type","SummaryModal","TYPE","body","templateContext","canedit","candelete","headerclasses","normalisedeventtype","isactionevent","action","ModalFactory","create","modal","getRoot","ModalEvents","hidden","destroy","show","init"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * A javascript module to handler calendar view changes.\n *\n * @module     core_calendar/view_manager\n * @copyright  2017 Andrew Nicols <andrew@nicols.co.uk>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport $ from 'jquery';\nimport Templates from 'core/templates';\nimport Notification from 'core/notification';\nimport * as CalendarRepository from 'core_calendar/repository';\nimport CalendarEvents from 'core_calendar/events';\nimport * as CalendarSelectors from 'core_calendar/selectors';\nimport ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\nimport SummaryModal from 'core_calendar/summary_modal';\nimport CustomEvents from 'core/custom_interaction_events';\nimport Pending from 'core/pending';\n\n/**\n * Register event listeners for the module.\n *\n * @param {object} root The root element.\n */\nconst registerEventListeners = (root) => {\n    root = $(root);\n    const container = root.parent();\n    const limitdayevents = container.data('limitdayevents');\n    console.info('aaaaaaaaaaaaa root', limitdayevents, root);\n\n    // Bind click events to event links.\n    root.on('click', CalendarSelectors.links.eventLink, (e) => {\n        const target = e.target;\n        let eventLink = null;\n        let eventId = null;\n        const pendingPromise = new Pending('core_calendar/view_manager:eventLink:click');\n\n        if (target.matches(CalendarSelectors.actions.viewEvent)) {\n            eventLink = target;\n        } else {\n            eventLink = target.closest(CalendarSelectors.actions.viewEvent);\n        }\n\n        if (eventLink) {\n            eventId = eventLink.dataset.eventId;\n        } else {\n            eventId = target.querySelector(CalendarSelectors.actions.viewEvent).dataset.eventId;\n        }\n\n        if (eventId) {\n            // A link was found. Show the modal.\n\n            e.preventDefault();\n            // We've handled the event so stop it from bubbling\n            // and causing the day click handler to fire.\n            e.stopPropagation();\n\n            renderEventSummaryModal(eventId)\n            .then(pendingPromise.resolve)\n            .catch();\n        } else {\n            pendingPromise.resolve();\n        }\n    });\n\n    root.on('click', CalendarSelectors.links.navLink, (e) => {\n        const wrapper = root.find(CalendarSelectors.wrapper);\n        const view = wrapper.data('view');\n        const courseId = wrapper.data('courseid');\n        const categoryId = wrapper.data('categoryid');\n        const link = e.currentTarget;\n\n        if (view === 'month' || view === 'monthblock') {\n            console.info('aaaaaa change month onclick', limitdayevents);\n            changeMonth(root, link.href, link.dataset.year, link.dataset.month, courseId, categoryId,\n                link.dataset.day, limitdayevents);\n            e.preventDefault();\n        } else if (view === 'day') {\n            changeDay(root, link.href, link.dataset.year, link.dataset.month, link.dataset.day, courseId, categoryId);\n            e.preventDefault();\n        }\n    });\n\n    const viewSelector = root.find(CalendarSelectors.viewSelector);\n    CustomEvents.define(viewSelector, [CustomEvents.events.activate]);\n    viewSelector.on(\n        CustomEvents.events.activate,\n        (e) => {\n            e.preventDefault();\n\n            const option = e.target;\n            if (option.classList.contains('active')) {\n                return;\n            }\n\n            const view = option.dataset.view,\n                year = option.dataset.year,\n                month = option.dataset.month,\n                day = option.dataset.day,\n                courseId = option.dataset.courseid,\n                categoryId = option.dataset.categoryid;\n\n            if (view == 'month') {\n                refreshMonthContent(root, year, month, courseId, categoryId, root, 'core_calendar/calendar_month',\n                    day, limitdayevents)\n                    .then(() => {\n                        updateUrl('?view=month');\n                    }).fail(Notification.exception);\n            } else if (view == 'day') {\n                refreshDayContent(root, year, month, day, courseId, categoryId, root, 'core_calendar/calendar_day')\n                    .then(() => {\n                        updateUrl('?view=day');\n                    }).fail(Notification.exception);\n            } else if (view == 'upcoming') {\n                reloadCurrentUpcoming(root, courseId, categoryId, root, 'core_calendar/calendar_upcoming')\n                    .then(() => {\n                        updateUrl('?view=upcoming');\n                    }).fail(Notification.exception);\n            }\n        }\n    );\n};\n\n/**\n * Refresh the month content.\n *\n * @param {object} root The root element.\n * @param {number} year Year\n * @param {number} month Month\n * @param {number} courseId The id of the course whose events are shown\n * @param {number} categoryId The id of the category whose events are shown\n * @param {object} target The element being replaced. If not specified, the calendarwrapper is used.\n * @param {string} template The template to be rendered.\n * @param {number} day Day (optional)\n * @param {number} limitdayevents limit day events\n * @return {promise}\n */\nexport const refreshMonthContent = (root, year, month, courseId, categoryId, target = null,\n        template = '', day = 1, limitdayevents = 0) => {\n    startLoading(root);\n\n    target = target || root.find(CalendarSelectors.wrapper);\n    template = template || root.attr('data-template');\n    M.util.js_pending([root.get('id'), year, month, courseId].join('-'));\n    const includenavigation = root.data('includenavigation');\n    const mini = root.data('mini');\n    const viewMode = target.data('view');\n    return CalendarRepository.getCalendarMonthData(year, month, courseId, categoryId, includenavigation,\n            mini, day, viewMode, limitdayevents)\n        .then(context => {\n            return Templates.render(template, context);\n        })\n        .then((html, js) => {\n            return Templates.replaceNode(target, html, js);\n        })\n        .then(() => {\n            document.querySelector('body').dispatchEvent(new CustomEvent(CalendarEvents.viewUpdated));\n            return;\n        })\n        .always(() => {\n            M.util.js_complete([root.get('id'), year, month, courseId].join('-'));\n            return stopLoading(root);\n        })\n        .fail(Notification.exception);\n};\n\n/**\n * Handle changes to the current calendar view.\n *\n * @param {object} root The container element\n * @param {string} url The calendar url to be shown\n * @param {number} year Year\n * @param {number} month Month\n * @param {number} courseId The id of the course whose events are shown\n * @param {number} categoryId The id of the category whose events are shown\n * @param {number} day Day (optional)\n * @param {number} limitdayevents limit number of day events\n * @return {promise}\n */\nexport const changeMonth = (root, url, year, month, courseId, categoryId, day = 1, limitdayevents = 0) => {\n    return refreshMonthContent(root, year, month, courseId, categoryId, null, '', day, limitdayevents)\n        .then((...args) => {\n            if (url.length && url !== '#') {\n                updateUrl(url);\n            }\n            return args;\n        })\n        .then((...args) => {\n            $('body').trigger(CalendarEvents.monthChanged, [year, month, courseId, categoryId]);\n            return args;\n        });\n};\n\n/**\n * Reload the current month view data.\n *\n * @param {object} root The container element.\n * @param {number} courseId The course id.\n * @param {number} categoryId The id of the category whose events are shown\n * @return {promise}\n */\nexport const reloadCurrentMonth = (root, courseId = 0, categoryId = 0) => {\n    const year = root.find(CalendarSelectors.wrapper).data('year');\n    const month = root.find(CalendarSelectors.wrapper).data('month');\n    const day = root.find(CalendarSelectors.wrapper).data('day');\n    const container = root.parent();\n    const limitdayevents = container.data('limitdayevents');\n\n    courseId = courseId || root.find(CalendarSelectors.wrapper).data('courseid');\n    categoryId = categoryId || root.find(CalendarSelectors.wrapper).data('categoryid');\n\n    return refreshMonthContent(root, year, month, courseId, categoryId, null, '', day, limitdayevents);\n};\n\n\n/**\n * Refresh the day content.\n *\n * @param {object} root The root element.\n * @param {number} year Year\n * @param {number} month Month\n * @param {number} day Day\n * @param {number} courseId The id of the course whose events are shown\n * @param {number} categoryId The id of the category whose events are shown\n * @param {object} target The element being replaced. If not specified, the calendarwrapper is used.\n * @param {string} template The template to be rendered.\n *\n * @return {promise}\n */\nexport const refreshDayContent = (root, year, month, day, courseId, categoryId, target = null, template = '') => {\n    startLoading(root);\n\n    if (!target || target.length == 0){\n        target = root.find(CalendarSelectors.wrapper);\n    }\n    template = template || root.attr('data-template');\n    M.util.js_pending([root.get('id'), year, month, day, courseId, categoryId].join('-'));\n    const includenavigation = root.data('includenavigation');\n    return CalendarRepository.getCalendarDayData(year, month, day, courseId, categoryId, includenavigation)\n        .then((context) => {\n            context.viewingday = true;\n            context.showviewselector = true;\n            return Templates.render(template, context);\n        })\n        .then((html, js) => {\n            return Templates.replaceNode(target, html, js);\n        })\n        .then(() => {\n            document.querySelector('body').dispatchEvent(new CustomEvent(CalendarEvents.viewUpdated));\n            return;\n        })\n        .always(() => {\n            M.util.js_complete([root.get('id'), year, month, day, courseId, categoryId].join('-'));\n            return stopLoading(root);\n        })\n        .fail(Notification.exception);\n};\n\n/**\n * Reload the current day view data.\n *\n * @param {object} root The container element.\n * @param {number} courseId The course id.\n * @param {number} categoryId The id of the category whose events are shown\n * @return {promise}\n */\nexport const reloadCurrentDay = (root, courseId = 0, categoryId = 0) => {\n    const wrapper = root.find(CalendarSelectors.wrapper);\n    const year = wrapper.data('year');\n    const month = wrapper.data('month');\n    const day = wrapper.data('day');\n\n    courseId = courseId || root.find(CalendarSelectors.wrapper).data('courseid');\n    categoryId = categoryId || root.find(CalendarSelectors.wrapper).data('categoryid');\n\n    return refreshDayContent(root, year, month, day, courseId, categoryId);\n};\n\n/**\n * Handle changes to the current calendar view.\n *\n * @param {object} root The root element.\n * @param {String} url The calendar url to be shown\n * @param {Number} year Year\n * @param {Number} month Month\n * @param {Number} day Day\n * @param {Number} courseId The id of the course whose events are shown\n * @param {Number} categoryId The id of the category whose events are shown\n * @return {promise}\n */\nexport const changeDay = (root, url, year, month, day, courseId, categoryId) => {\n    return refreshDayContent(root, year, month, day, courseId, categoryId)\n        .then((...args) => {\n            if (url.length && url !== '#') {\n                updateUrl(url);\n            }\n            return args;\n        })\n        .then((...args) => {\n            $('body').trigger(CalendarEvents.dayChanged, [year, month, courseId, categoryId]);\n            return args;\n        });\n};\n\n/**\n * Update calendar URL.\n *\n * @param {String} url The calendar url to be updated.\n */\nexport const updateUrl = (url) => {\n    const viewingFullCalendar = document.getElementById(CalendarSelectors.fullCalendarView);\n\n    // We want to update the url only if the user is viewing the full calendar.\n    if (viewingFullCalendar) {\n        window.history.pushState({}, '', url);\n    }\n};\n\n/**\n * Set the element state to loading.\n *\n * @param {object} root The container element\n * @method startLoading\n */\nconst startLoading = (root) => {\n    const loadingIconContainer = root.find(CalendarSelectors.containers.loadingIcon);\n\n    loadingIconContainer.removeClass('hidden');\n};\n\n/**\n * Remove the loading state from the element.\n *\n * @param {object} root The container element\n * @method stopLoading\n */\nconst stopLoading = (root) => {\n    const loadingIconContainer = root.find(CalendarSelectors.containers.loadingIcon);\n\n    loadingIconContainer.addClass('hidden');\n};\n\n/**\n * Reload the current month view data.\n *\n * @param {object} root The container element.\n * @param {number} courseId The course id.\n * @param {number} categoryId The id of the category whose events are shown\n * @param {object} target The element being replaced. If not specified, the calendarwrapper is used.\n * @param {string} template The template to be rendered.\n * @return {promise}\n */\nexport const reloadCurrentUpcoming = (root, courseId = 0, categoryId = 0, target = null, template = '') => {\n    startLoading(root);\n\n    target = target || root.find(CalendarSelectors.wrapper);\n    template = template || root.attr('data-template');\n    courseId = courseId || root.find(CalendarSelectors.wrapper).data('courseid');\n    categoryId = categoryId || root.find(CalendarSelectors.wrapper).data('categoryid');\n\n    return CalendarRepository.getCalendarUpcomingData(courseId, categoryId)\n        .then((context) => {\n            context.viewingupcoming = true;\n            context.showviewselector = true;\n            return Templates.render(template, context);\n        })\n        .then((html, js) => {\n            return Templates.replaceNode(target, html, js);\n        })\n        .then(() => {\n            document.querySelector('body').dispatchEvent(new CustomEvent(CalendarEvents.viewUpdated));\n            return;\n        })\n        .always(function() {\n            return stopLoading(root);\n        })\n        .fail(Notification.exception);\n};\n\n/**\n * Get the CSS class to apply for the given event type.\n *\n * @param {string} eventType The calendar event type\n * @return {string}\n */\nconst getEventTypeClassFromType = (eventType) => {\n    return 'calendar_event_' + eventType;\n};\n\n/**\n * Render the event summary modal.\n *\n * @param {Number} eventId The calendar event id.\n * @returns {Promise}\n */\nconst renderEventSummaryModal = (eventId) => {\n    const pendingPromise = new Pending('core_calendar/view_manager:renderEventSummaryModal');\n\n    // Calendar repository promise.\n    return CalendarRepository.getEventById(eventId)\n    .then((getEventResponse) => {\n        if (!getEventResponse.event) {\n            throw new Error('Error encountered while trying to fetch calendar event with ID: ' + eventId);\n        }\n\n        return getEventResponse.event;\n    })\n    .then(eventData => {\n        // Build the modal parameters from the event data.\n        const modalParams = {\n            title: eventData.name,\n            type: SummaryModal.TYPE,\n            body: Templates.render('core_calendar/event_summary_body', eventData),\n            templateContext: {\n                canedit: eventData.canedit,\n                candelete: eventData.candelete,\n                headerclasses: getEventTypeClassFromType(eventData.normalisedeventtype),\n                isactionevent: eventData.isactionevent,\n                url: eventData.url,\n                action: eventData.action\n            }\n        };\n\n        // Create the modal.\n        return ModalFactory.create(modalParams);\n    })\n    .then(modal => {\n        // Handle hidden event.\n        modal.getRoot().on(ModalEvents.hidden, function() {\n            // Destroy when hidden.\n            modal.destroy();\n        });\n\n        // Finally, render the modal!\n        modal.show();\n\n        return modal;\n    })\n    .then(modal => {\n        pendingPromise.resolve();\n\n        return modal;\n    })\n    .catch(Notification.exception);\n};\n\nexport const init = (root, view) => {\n    registerEventListeners(root, view);\n};\n"],"file":"view_manager.min.js"}